"0",""
"0","## Demand Parameters"
"0","parameter <- IVreg$coefficients"
"0",""
"0","## New data"
"0","df_sim <- read.csv(""Data/Main/data_updated.csv"", "
"0","                   header = T, fileEncoding = ""shift-JIS"")"
"0",""
"0","## Attach new airlineNo"
"0","N_airline <- 10"
"0","airlineNo <- seq(1:N_airline)"
"0","airlinenames <- c(""JAL"", ""ANA"", ""SFJ"", ""SKY"", ""JAC"", ""ADO"", ""IBX"", ""JTA"", ""HAC"", ""JEX"")"
"0",""
"0","airline_correspondence <- cbind(airlineNo, airlinenames) %>% "
"0","  as_tibble() %>% "
"0","  dplyr::mutate(airlineNo = as.numeric(airlineNo))"
"0",""
"0","df_sim <- df_sim %>% "
"0","  dplyr::left_join(airline_correspondence, "
"0","                   by = c(""航空会社"" = ""airlinenames"")) %>% "
"0","  tidyr::replace_na(replace = list(airlineNo = 0))"
"0",""
"0","## Prepare adjustment parameter alpha"
"0","### Revise Later"
"0","calculate.alpha <- function(x, y){"
"0","  X <<- x %*% t(y) - diag(y)"
"0","  L <<- X"
"0","  L[upper.tri(L)] <<- 0"
"0","  U <<- X"
"0","  U[lower.tri(U, diag = T)] <<- 0"
"0","  iteration <- 1000"
"0","  xx <<- matrix(rep(1, length(x)), nrow = length(x), ncol = 1) ## Initial value"
"0","  for(k in 1:iteration){"
"0","    xx <<- (-1)*solve(L) %*% U %*% xx"
"0","  }"
"0","  output <<- xx[, 1]/xx[1,1]"
"0","  return(output)"
"0","}"
"0",""
"0","## Add alpha"
"0","df_sim <- df_sim %>% "
"0","  # Replace NAs in Freq with 1"
"0","  tidyr::replace_na(replace = list(Freq = 1)) %>% "
"0","  # Calculate Mean Utility"
"0","  dplyr::mutate(utility = "
"0","                  parameter[1]"
"0","                + parameter[2] * 費用 "
"0","                + parameter[3] * log(Freq)"
"0","                + parameter[4] * アクセシビリティ"
"0","                + parameter[5] * 鉄道ダミー"
"0","                + parameter[6] * 一便あたり座席数"
"0","                + parameter[7] * 一便あたり貨物"
"0","                + parameter[8] * 所要時間,"
"0","                exputility = exp(utility)) %>% "
"0","  ## Add alpha"
"0","  dplyr::group_by(i, j) %>% "
"0","  dplyr::mutate(alpha = calculate.alpha(observedprob, exputility)) %>% "
"0","  dplyr::ungroup()"
"0",""
