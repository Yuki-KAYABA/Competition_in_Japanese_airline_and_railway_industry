"0","## Add airline data for IV estimation"
"0","airline.as.IV <- airline.as.IV %>% "
"0","  dplyr::left_join(airport.number, by = c(""空港i"" = ""空港"")) %>% "
"0","  dplyr::left_join(airport.number, by = c(""空港j"" = ""空港"")) %>% "
"0","  tidyr::drop_na(c(No.x, No.y)) %>% "
"0","  dplyr::mutate_at(vars(人キロメートル, 座席キロメートル, "
"0","                        貨物, 超過手荷物, 郵便物, 旅客, "
"0","                        貨物.1, 超過手荷物.1, 郵便物.1, "
"0","                        計, 利用可能.トンキロメートル),"
"0","                   ~ stringr::str_replace_all(., "","", """")) %>% "
"0","  dplyr::mutate_at(vars(人キロメートル, 座席キロメートル, "
"0","                        貨物, 超過手荷物, 郵便物, 旅客, "
"0","                        貨物.1, 超過手荷物.1, 郵便物.1, "
"0","                        計, 利用可能.トンキロメートル),"
"0","                   ~ as.numeric(.)) %>% "
"0","  dplyr::mutate(一便あたり座席数 = 座席数 / 運航回数, "
"0","                一便あたり貨物 = 貨物 / 運航回数, "
"0","                一便あたり超過手荷物 = 超過手荷物 / 運航回数, "
"0","                路線距離 = 運航キロメートル / 運航回数) %>% "
"0","  dplyr::select(""No.x"", ""No.y"", ""一便あたり座席数"", "
"0","                ""一便あたり貨物"", ""一便あたり超過手荷物"", ""路線距離"") %>% "
"0","  dplyr::group_by(No.x, No.y) %>% "
"0","  dplyr::summarise_at(vars(""一便あたり座席数"", ""一便あたり貨物"", "
"0","                           ""一便あたり超過手荷物"", ""路線距離""),"
"0","                      ~ mean(.))"
"0",""
"0","## Merge"
"0","## Add to Airline"
"0","dataframe.airline <- dataframe.airline %>% "
"0","  dplyr::left_join(airline.as.IV, by = c(""X47ゾーンi"" = ""No.x"","
"0","                                         ""X47ゾーンj"" = ""No.y"")) %>% "
"0","  tidyr::replace_na(replace = list(一便あたり座席数 = 0, "
"0","                                   一便あたり貨物 = 0,"
"0","                                   一便あたり超過手荷物 = 0,"
"0","                                   路線距離 = 0))"
"0",""
"0","## Add to Railway"
"0","dataframe.railway <- dataframe.railway %>% "
"0","  dplyr::mutate(一便あたり座席数 = 0, "
"0","                一便あたり貨物 = 0, "
"0","                一便あたり超過手荷物 = 0)"
"0",""
"0","## Combine Airline and Railway Data to Get Dataframe"
"0","df <- dataframe.airline %>% "
"0","  dplyr::bind_rows(dataframe.railway) %>% "
"0","  dplyr::arrange(i, j) %>% "
"0","  # Compute share and outside share"
"0","  dplyr::mutate(prob1 = x/OD1, prob2 = x/OD2) %>% "
"0","  dplyr::mutate(share1 = ifelse(prob1 == 0, 1e-3, ifelse(prob1 == 1, 1 - 1e-3, prob1)), "
"0","                share2 = ifelse(prob2 == 0, 1e-3, ifelse(prob2 == 1, 1 - 1e-3, prob2))) %>% "
"0","  dplyr::group_by(i, j) %>% "
"0","  dplyr::mutate(out.share2 = 1 - sum(share2)) %>% "
"0","  dplyr::ungroup() %>% "
"0","  dplyr::mutate(y = log(share1) - log(1 - share1)) %>% "
"0","  # Drop NAs"
"0","  tidyr::drop_na()"
